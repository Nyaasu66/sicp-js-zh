# 2
用数据构建抽象

> 我们现在到了数学抽象的决定性一步:我们忘记了符号代表什么。。。。[数学家]不必无所事事；他可以用这些符号进行许多操作，而不必看它们所代表的东西。
> 
> —赫尔曼·韦勒，数学思维方式

我们在第一章集中讨论了计算过程和函数在程序设计中的作用。我们看到了如何使用原始数据(数字)和原始操作(算术运算)，如何通过组合、条件和参数的使用来组合函数以形成复合函数，以及如何通过使用函数声明来抽象流程。我们看到一个函数可以被视为一个过程的局部演化的模式，我们对函数中包含的一些常见过程模式进行了分类、推理和简单的算法分析。我们还看到，高阶函数通过使我们能够操纵一般的计算方法，从而进行推理，增强了我们语言的能力。这是编程的本质。

在这一章中，我们将研究更复杂的数据。第一章中的所有函数都是对简单的数字数据进行操作的，而简单的数据不足以解决我们希望用计算来解决的许多问题。程序通常被设计成模拟复杂的现象，并且为了模拟具有几个方面的真实世界的现象，人们常常必须构造具有几个部分的计算对象。因此，尽管我们在第 1 章的重点是通过组合函数形成复合函数来构建抽象，但我们在本章转向任何编程语言的另一个关键方面:它提供了通过组合数据对象形成复合数据来构建抽象的方法。

为什么我们希望在编程语言中使用复合数据？出于同样的原因，我们需要复合功能:提升我们设计程序的概念层次，增加我们设计的模块性，增强我们语言的表达能力。正如声明函数的能力使我们能够在比语言的原始操作更高的概念层次上处理过程一样，构造复合数据对象的能力使我们能够在比语言的原始数据对象更高的概念层次上处理数据。

考虑设计一个用有理数进行算术运算的系统的任务。我们可以想象一个运算`add_rat`,它取两个有理数并产生它们的和。就简单的数据而言，一个有理数可以被认为是两个整数:一个分子和一个分母。因此，我们可以设计一个程序，其中每个有理数由两个整数(一个分子和一个分母)表示，而`add_rat`由两个函数实现(一个产生总和的分子，一个产生分母)。但是这将会很尴尬，因为我们需要明确地跟踪哪些分子对应于哪些分母。在一个打算对许多有理数执行许多运算的系统中，这样的簿记细节会使程序变得非常混乱，更不用说它们会对我们的大脑产生什么影响了。如果我们能够将分子和分母“粘在一起”形成一对——一个复合数据对象——我们的程序能够以一种与将有理数视为一个单一概念单位相一致的方式操纵它，那将会好得多。

复合数据的使用也使我们能够增加程序的模块性。如果我们可以直接将有理数作为对象来操作，那么我们就可以将程序中处理有理数本身的部分与有理数如何表示成整数对的细节分开。将处理数据对象如何表示的程序部分与处理数据对象如何使用的程序部分隔离开来的一般技术是一种强大的设计方法，称为数据抽象。我们将看到数据抽象如何使程序更容易设计、维护和修改。

复合数据的使用导致了我们编程语言表达能力的真正提高。考虑由形成一个`ax + by`的“线性组合”的思路。我们可能想写一个函数，接受`a`、`b`、`x`和`y`作为参数，并通过返回`ax + by`的值。如果参数是数字，这并不困难，因为我们可以很容易地声明函数

```js
function linear_combination(a, b, x, y) {
    return a * x + b * y;
}
```

但是假设我们不仅仅关心数字。假设我们想要描述一个无论何时定义加法和乘法都形成线性组合的过程——对于有理数、复数、多项式或任何东西。我们可以把它表达为形式的函数

**function** linear_combination(a, b, x, y) {

```js
    return add(mul(a, x), mul(b, y));
}
```

其中`add`和`mul`不是原始函数`+`和`*`，而是更复杂的东西，它们将对我们作为参数`a`、`b`、`x`和`y`传入的任何类型的数据执行适当的操作。关键是`linear_combination`需要知道的关于`a`、`b`、`x`和`y`的唯一事情是函数`add`和`mul`将执行适当的操作。从函数`linear_combination`的角度来看，什么是`a`、`b`、`x`和`y`是不相关的，更不相关的是它们可能如何碰巧用更原始的数据来表示。这个例子说明了为什么我们的编程语言提供直接操纵复合对象的能力是重要的:没有这一点，像`linear_combination`这样的函数就无法在不知道它们的详细结构的情况下将其参数传递给`add`和`mul`。 [¹](#c2-fn-0001)

我们从实现上面提到的有理数算术系统开始这一章。这将构成我们讨论复合数据和数据抽象的背景。与复合函数一样，要解决的主要问题是抽象作为一种处理复杂性的技术，我们将看到数据抽象如何使我们能够在程序的不同部分之间建立合适的抽象壁垒。

我们将看到，形成复合数据的关键是，编程语言应该提供某种“胶水”，以便数据对象可以组合起来形成更复杂的数据对象。胶水有很多种。事实上，我们将发现如何不使用任何特殊的“数据”操作，只使用函数来形成复合数据。这将进一步模糊“功能”和“数据”之间的区别，这在第一章的末尾已经变得模糊不清了。我们还将探索一些表示序列和树的传统技术。处理复合数据的一个关键思想是闭包的概念——我们用来组合数据对象的胶水应该允许我们不仅组合原始数据对象，也组合复合数据对象。另一个关键思想是，复合数据对象可以作为传统接口以混合匹配的方式组合程序模块。我们通过展示一种利用闭包的简单图形语言来说明其中的一些想法。

然后，我们将通过引入符号表达式来增强语言的表达能力，这些数据的基本部分可以是任意符号，而不仅仅是数字。我们探索了表示对象集合的各种替代方法。我们将会发现，正如给定的数值函数可以通过许多不同的计算过程来计算一样，给定的数据结构可以通过许多方式用更简单的对象来表示，并且表示的选择可以对操纵数据的过程的时间和空间要求产生重大影响。我们将在符号微分、集合表示和信息编码的背景下研究这些观点。接下来，我们将讨论处理数据的问题，这些数据可能由程序的不同部分以不同的方式表示。这导致需要实现通用操作，它必须处理许多不同类型的数据。在存在通用操作的情况下保持模块化需要比简单的数据抽象更强大的抽象障碍。特别是，我们引入了数据导向编程，作为一种技术，它允许单独的数据表示被孤立地设计，然后被相加地(即，没有修改)组合。为了说明这种方法对系统设计的强大作用，我们在本章结束时将我们所学的知识应用于一个对多项式执行符号运算的包的实现，其中多项式的系数可以是整数、有理数、复数，甚至其他多项式。